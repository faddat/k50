<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K50 Visualization</title>
    <link rel="stylesheet" type="text/css" href="./public/css/styles.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="controls">
      <button onclick="window.K50.toggleDebug()">Debug</button>
    </div>
    <div class="audio-controls">
      <button onclick="window.K50.toggleMusic()">Toggle Music</button>
    </div>
    <div class="microphone-control">
      <button onclick="window.K50.handleMicrophoneToggle()">Toggle Microphone</button>
    </div>
    <div class="node-count-container sliding-element">
      <div class="label" id="label">Kn =</div>
      <input
        type="number"
        id="nodeCount"
        min="3"
        max="200"
        value="180"
        onchange="window.K50.handleNodeCountChange(this.value)"
      />
    </div>
    <div class="mode-indicator">Mode: Classic</div>
    <div id="debug"></div>

    <!-- Initialize app -->
    <script type="module">
      // Import Three.js as a module
      import * as THREE from './public/js/lib/three.module.js';
      
      // Make THREE available globally for legacy code
      window.THREE = THREE;
      
      // Load Stats.js
      const statsScript = document.createElement('script');
      statsScript.src = './public/js/lib/stats.min.js';
      document.head.appendChild(statsScript);

      // Wait for Stats.js to load
      await new Promise(resolve => {
        statsScript.onload = resolve;
      });

      // Import and initialize our app
      const { initApp, toggleDebug, handleNodeCountChange } = await import('./public/js/modules/app.js');
      const { handleMicrophoneToggle, handleMusicToggle } = await import('./public/js/modules/controls.js');

      // Create global namespace for the app
      window.K50 = {
        toggleDebug,
        handleNodeCountChange,
        handleMicrophoneToggle,
        handleMusicToggle,
      };

      // Initialize when everything is ready
      window.addEventListener('load', async () => {
        try {
          console.log('Starting app initialization...');
          await initApp();
          console.log('App initialized successfully');
        } catch (error) {
          console.error('Failed to initialize app:', error);
        }
      });
    </script>
  </body>
</html> 